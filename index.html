<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>自訂圖標示例</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.css" />
  <style>
    #map {
      height: 600px;
      width: 100%;
      border: 2px solid rgba(51, 51, 51, 0.31);
    }
    .scroll-map-div-icon-label {
      background-color: rgba(210, 34, 34, 0.91);
      color: white;
      padding: 4px;
      border-radius: 10px;
      white-space: nowrap;
      text-align: center;
    }
    #controls {
      margin: 10px 0;
    }
    #mouse-position {
      display: inline-block;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 5px;
      border-radius: 5px;
      font-size: 14px;
    }
    #mouse-click-records {
      margin-top: 20px;
      list-style-type: none;
      padding: 0;
    }
    #mouse-click-records li {
      padding: 5px;
      background-color: #f8f9fa;
      margin: 5px 0;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<main>
  <h1>自訂圖標示例 <span id="mouse-position">滑鼠位置：-</span></h1>
  <div id="controls">
    <label>
      <input type="checkbox" id="toggle-all-markers" checked>
      顯示所有圖標
    </label>
    <label>
      <input type="checkbox" id="toggle-specific-marker" checked>
      顯示特定圖標
    </label>
  </div>
  <div id="map"></div>

  <div>
    <h3>滑鼠點擊記錄：</h3>
    <ul id="mouse-click-records"></ul>
  </div>
</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.min.js"></script>
<script>
  // 初始化地圖
  var map = L.map('map', {
    crs: L.CRS.Simple,
    zoomDelta: 1,
    maxZoom: 4.5,
    minZoom: -1,
    fullscreenControl: true, // 啟用全螢幕控制
    fullscreenControlOptions: {
      position: 'topleft' // 按鈕位置，可選 "topleft" 或 "topright"
    }
  }).setView([0, 0], 0);

  // 添加自訂圖片圖層
  var bounds = [[0, 0], [1000, 1000]];
  L.imageOverlay('https://phoenix-open-image.s3.ap-southeast-2.amazonaws.com/MAP_4_4.png', bounds).addTo(map);

  // 使用自訂樣式的 divIcon，讓圖標大小符合文字並使定位基於文字的長度
  function createCustomIcon(label, fontSize = 10) {
    var textWidth = label.length * fontSize * 0.8;
    var width = Math.max(20, textWidth + 5);
    var height = Math.max(15, fontSize + 1);

    var iconAnchorX = width / 2;
    var iconAnchorY = height / 2;

    return L.divIcon({
      className: 'scroll-map-div-icon-label',
      html: `<div style="
        background-color: rgba(210, 34, 34, 0.91);
        color: white;
        padding: 20;
        border-radius: 20;
        font-size: ${fontSize}px;
        width: ${width}px;
        height: ${height}px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        text-align: center;
      ">${label}</div>`,
      iconSize: [width, height],
      iconAnchor: [iconAnchorX, iconAnchorY]
    });
  }

  // 標記的座標和對應資訊
  var positions = [
    { coords: [706.14, 715.29], label: '標記1', info: '這是標記1的專屬資訊' },
    { coords: [705, 686], label: '標記2', info: '這是標記2的專屬資訊' },
  //
{ coords: [528.04, 666.10], label: '村上', info: '' },
{ coords: [531.57, 588.89], label: '佐渡', info: '' },
{ coords: [508.57, 647.62], label: '新潟', info: '' },
{ coords: [498.81, 647.67], label: '長岡', info: '' },
{ coords: [489.09, 657.35], label: '魚沼', info: '' },
{ coords: [479.36, 647.67], label: '湯沢', info: '' },
{ coords: [479.36, 597.68], label: '上越', info: '' },
{ coords: [469.55, 607.89], label: '長野', info: '' },
{ coords: [469.64, 618.10], label: '小布施', info: '' },
{ coords: [459.88, 607.80], label: '千曲', info: '' },
{ coords: [459.83, 637.99], label: '軽井沢', info: '' },
{ coords: [440.34, 607.84], label: '上田', info: '' },
{ coords: [420.85, 597.63], label: '小淵沢', info: '' },
{ coords: [411.18, 597.63], label: '甲府', info: '' },
{ coords: [400.79, 607.93], label: '富士吉田', info: '' },
{ coords: [322.87, 540.68], label: '豊橋', info: '' },
{ coords: [322.92, 550.40], label: '浜松', info: '' },
{ coords: [342.36, 578.11], label: '静岡', info: '' },
{ coords: [342.40, 589.74], label: '富士宮', info: '' },
{ coords: [342.31, 609.14], label: '三島', info: '' },
{ coords: [342.36, 618.91], label: '熱海', info: '' },
{ coords: [332.64, 609.19], label: '修善寺', info: '' },
{ coords: [322.83, 599.42], label: '松崎', info: '' },
{ coords: [322.88, 618.95], label: '伊豆高原', info: '' },
{ coords: [302.82, 609.10], label: '下田', info: '' },
{ coords: [411.10, 450.91], label: '小浜', info: '' },
{ coords: [411.05, 470.32], label: '敦賀', info: '' },
{ coords: [420.91, 490.16], label: '鯖江', info: '' },
{ coords: [430.54, 500.11], label: '福井', info: '' },
{ coords: [430.58, 509.88], label: '小松', info: '' },
{ coords: [440.39, 500.15], label: '東尋坊', info: '' },
{ coords: [440.35, 509.88], label: '金沢', info: '' },
{ coords: [440.30, 519.65], label: '香林坊', info: '' },
{ coords: [440.39, 529.42], label: '茶屋街', info: '' },
{ coords: [479.36, 519.65], label: '和倉温泉', info: '' },
{ coords: [468.10, 519.65], label: '氷見', info: '' },
{ coords: [468.14, 539.19], label: '射水', info: '' },
{ coords: [459.88, 529.37], label: '高岡', info: '' },
{ coords: [459.88, 539.10], label: '富山', info: '' },
{ coords: [469.60, 578.04], label: '糸魚川', info: '' },
{ coords: [459.93, 578.12], label: '白馬', info: '' },
{ coords: [430.59, 578.12], label: '松本', info: '' },
{ coords: [411.05, 578.08], label: '駒ヶ根', info: '' },
{ coords: [420.82, 539.17], label: '高山', info: '' },
{ coords: [410.30, 509.61], label: '郡上', info: '' },
{ coords: [390.86, 509.61], label: '岐阜', info: '' },
{ coords: [371.37, 529.19], label: '標記22', info: '' },
{ coords: [371.37, 548.90], label: '標記23', info: '' },
{ coords: [361.60, 509.70], label: '標記24', info: '' },
{ coords: [361.60, 519.47], label: '標記25', info: '' },
{ coords: [361.56, 529.68], label: '標記26', info: '' },
{ coords: [361.65, 538.96], label: '標記27', info: '' },
{ coords: [351.40, 499.93], label: '標記28', info: '' },
{ coords: [351.88, 519.47], label: '標記29', info: '' },
{ coords: [351.84, 529.90], label: '標記30', info: '' },
{ coords: [332.35, 509.70], label: '標記31', info: '' },
  //
  { coords: [469.56, 637.91], label: '草津', info: '' },
{ coords: [469.60, 647.63], label: '沼田', info: '' },
{ coords: [459.79, 647.63], label: '高崎', info: '' },
{ coords: [450.07, 647.63], label: '深谷', info: '' },
{ coords: [450.07, 657.36], label: '熊谷', info: '' },
{ coords: [440.35, 667.17], label: 'さいたま', info: '' },
{ coords: [430.72, 667.17], label: '上野', info: '' },
{ coords: [420.91, 667.13], label: '秋葉原', info: '' },
{ coords: [430.58, 676.90], label: '浅草', info: '' },
{ coords: [440.35, 706.15], label: '土浦', info: '' },
{ coords: [459.84, 706.19], label: '笠間', info: '' },
{ coords: [459.89, 715.91], label: '水戸', info: '' },
{ coords: [469.56, 715.91], label: 'ひたちなか', info: '' },
{ coords: [489.14, 725.68], label: '北茨城', info: '' },
{ coords: [489.14, 706.14], label: '那須', info: '' },
{ coords: [479.33, 686.65], label: '宇都宮', info: '' },
{ coords: [459.93, 676.93], label: '栃木', info: '' },
{ coords: [459.84, 667.12], label: '桐生', info: '' },
{ coords: [459.88, 657.44], label: '前橋', info: '' },
{ coords: [342.38, 628.62], label: '湯河原', info: '' },
{ coords: [352.10, 628.66], label: '小田原', info: '' },
{ coords: [362.35, 618.36], label: '箱根', info: '' },
{ coords: [361.91, 637.90], label: '小田原', info: '' },
{ coords: [352.14, 637.90], label: '湯河原', info: '' },
{ coords: [371.59, 637.95], label: '中華街', info: '' },
{ coords: [371.59, 647.63], label: '横浜', info: '' },
{ coords: [371.54, 657.44], label: '川崎', info: '' },
{ coords: [391.60, 676.93], label: 'お台場', info: '' },
{ coords: [391.56, 657.43], label: '品川', info: '' },
{ coords: [391.56, 647.53], label: '渋谷', info: '' },
{ coords: [401.36, 647.62], label: '原宿', info: '' },
{ coords: [391.69, 637.94], label: '千駄ヶ谷', info: '' },
{ coords: [431.06, 618.10], label: '秩父', info: '' },
{ coords: [420.86, 637.86], label: '大久保', info: '' },
{ coords: [411.00, 618.14], label: '八王子', info: '' },
{ coords: [411.05, 637.86], label: '新宿', info: '' },
{ coords: [411.05, 647.63], label: '後楽園', info: '' },
{ coords: [411.13, 667.20], label: '東京', info: '' },
{ coords: [411.04, 676.84], label: '日本橋', info: '' },
{ coords: [401.32, 676.89], label: '銀座', info: '' },
{ coords: [411.04, 686.61], label: '船橋', info: '' },
{ coords: [411.04, 696.47], label: '佐原', info: '' },
{ coords: [401.32, 686.61], label: '幕張', info: '' },
{ coords: [391.60, 686.61], label: '千葉', info: '' },
{ coords: [391.60, 706.19], label: '銚子', info: '' },
{ coords: [332.83, 686.70], label: '館山', info: '' },
{ coords: [352.58, 706.19], label: '鴨川', info: '' },
{ coords: [272.33, 657.49], label: '伊豆大島', info: '' },
{ coords: [189.60, 673.88], label: '八丈島', info: '' },
{ coords: [58.88, 919.65], label: 'ホノルル', info: '' },
    //
{ coords: [331.80, 490.62], label: '四日市', info: '' },
{ coords: [312.27, 490.62], label: '津', info: '' },
{ coords: [302.55, 490.62], label: '松阪', info: '' },
{ coords: [292.79, 490.71], label: '伊勢', info: '' },
{ coords: [292.83, 500.92], label: '鳥羽', info: '' },
{ coords: [283.15, 462.69], label: '新宮', info: '' },
{ coords: [292.87, 442.93], label: '五條', info: '' },
{ coords: [302.59, 451.60], label: '橿原', info: '' },
{ coords: [312.40, 461.98], label: '奈良', info: '' },
{ coords: [322.08, 471.13], label: '伊賀', info: '' },
{ coords: [263.62, 403.85], label: '白浜', info: '' },
{ coords: [273.34, 403.94], label: '御坊', info: '' },
{ coords: [283.10, 403.94], label: '和歌山', info: '' },
{ coords: [292.82, 403.98], label: '岸和田', info: '' },
{ coords: [302.63, 403.98], label: '堺', info: '' },
{ coords: [312.31, 413.62], label: '天王寺', info: '' },
{ coords: [322.16, 382.72], label: '淡路島', info: '' },
{ coords: [331.88, 382.64], label: '明石', info: '' },
{ coords: [331.84, 392.41], label: '神戸', info: '' },
{ coords: [341.60, 392.36], label: '有馬', info: '' },
{ coords: [322.12, 402.44], label: '天保山', info: '' },
{ coords: [322.12, 413.71], label: 'なんば', info: '' },
{ coords: [322.16, 423.43], label: '北浜', info: '' },
{ coords: [322.12, 433.20], label: '京橋', info: '' },
{ coords: [312.31, 433.07], label: '鶴橋', info: '' },
{ coords: [331.84, 441.91], label: '門真', info: '' },
{ coords: [351.33, 422.37], label: '大阪', info: '' },
{ coords: [331.80, 413.67], label: '吹田', info: '' },
{ coords: [401.06, 480.35], label: '長浜', info: '' },
{ coords: [380.65, 480.31], label: '彦根', info: '' },
{ coords: [370.75, 480.35], label: '近江八幡', info: '' },
{ coords: [370.80, 471.11], label: '大津', info: '' },
{ coords: [361.03, 461.39], label: '祇園', info: '' },
{ coords: [361.03, 451.71], label: '京都', info: '' },
{ coords: [361.03, 441.90], label: '嵐山', info: '' },
{ coords: [411.05, 421.56], label: '舞鶴', info: '' },
{ coords: [400.09, 372.86], label: '鳥取', info: '' },
{ coords: [409.81, 392.31], label: '城崎', info: '' },
{ coords: [400.05, 402.13], label: '出石', info: '' },
{ coords: [380.60, 392.41], label: '福知山', info: '' },
{ coords: [351.19, 392.69], label: '三田', info: '' },
{ coords: [351.19, 373.25], label: '姫路', info: '' },
{ coords: [342.60, 363.19], label: '赤穂', info: '' },
  //
  ];
  
  // 添加特定標記
  specificMarker = L.marker([500, 500], { icon: createCustomIcon('特定標記') }).addTo(map);
  specificMarker.bindPopup(''); // 預設為空資訊

  // 初始化標記
  var allMarkers = [];
  positions.forEach((pos) => {
    var marker = L.marker(pos.coords, { icon: createCustomIcon(pos.label) }).addTo(map);
    marker.bindPopup(pos.info); // 綁定專屬資訊
    allMarkers.push(marker);
  });

  // 縮放事件處理
  map.on('zoomend', function () {
    var currentZoom = map.getZoom();
    var fontSize = Math.max(12, Math.min(10, currentZoom * 1));
    allMarkers.forEach((marker, index) => {
      var pos = positions[index];
      var newIcon = createCustomIcon(pos.label, fontSize);
      marker.setIcon(newIcon);
    });
  });

  // 滑鼠位置記錄
  var mouseClickPositions = [];

  // 監聽滑鼠移動事件顯示當前位置
  map.on('mousemove', function(event) {
    var positionElement = document.getElementById('mouse-position');
    positionElement.textContent = `滑鼠位置：${event.latlng.lat.toFixed(2)}, ${event.latlng.lng.toFixed(2)}`;
  });

  // 監聽左鍵點擊事件
  map.on('click', function(event) {
    if (event.originalEvent.button === 0) {
      var clickPosition = {
        lat: event.latlng.lat.toFixed(2),
        lng: event.latlng.lng.toFixed(2)
      };
      mouseClickPositions.push(clickPosition);

      // 顯示所有記錄的點擊位置
      updateClickPositionsDisplay();
    }
  });

  // 更新顯示所有的滑鼠點擊位置
  function updateClickPositionsDisplay() {
    var positionsList = document.getElementById('mouse-click-records');
    positionsList.innerHTML = '';
    mouseClickPositions.forEach(function(position, index) {
      var listItem = document.createElement('li');
      listItem.textContent = `{ coords: [${position.lat}, ${position.lng}], label: '標記${index + 1}', info: '' },`;
      positionsList.appendChild(listItem);
    });
  }

  // 切換所有圖標的顯示
  document.getElementById('toggle-all-markers').addEventListener('change', function(event) {
    var checked = event.target.checked;
    allMarkers.forEach(function(marker) {
      if (checked) {
        marker.addTo(map);
      } else {
        map.removeLayer(marker);
      }
    });
  });
</script>

</body>
</html>
